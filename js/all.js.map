{"version":3,"sources":["all.js"],"names":["apiDomain","isPreview","sendFormData","data","apiUrl","isMainPage","isCreate","formData","i","$","length","eq","attr","val","itemBoxKey","j","find","formBindItems","k","parseInt","console","log","ajax","url","concat","type","method","dataType","contentType","stringify","done","res","LoadingOverlay","location","nextTo","window","bindEvent","forms","querySelectorAll","Array","prototype","slice","call","form","addEventListener","event","checkValidity","preventDefault","stopPropagation","classList","add","getUrlQuery","href","ary","split","key","uploadFile","fileInput","FormData","append","files","timeout","processData","mimeType","JSON","img","parse","alert","deleteApi","params","id","reload","fail","document","ready","localStorage","getItem","pathname","indexOf","on","this","prev","html"],"mappings":"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","file":"all.js","sourcesContent":["// Example starter JavaScript for disabling form submissions if there are invalid fields\r\nlet apiDomain= 'http://kiwi.ponitor.com.tw';\r\nlet isPreview = false;\r\nlet apiUrl = '';\r\n\r\n\r\nfunction sendFormData(data) {\r\n  // console.log(data)\r\n  apiUrl = data.apiUrl;\r\n  let isCreate = data.isMainPage?\"\":data.isCreate?'/create':\"/update\";\r\n  let method = data.isCreate||data.isMainPage?'post':\"put\";\r\n\r\n  // let dataForm = document.getElementById('dataForm');\r\n  // let formData = new FormData(dataForm);\r\n\r\n  // //檢查formdata值\r\n  // let object = {};\r\n  // formData.forEach((value, key) => { object[key] = value });\r\n  // let json = JSON.stringify(object);\r\n  // console.log('formfata:'+json);\r\n\r\n  \r\n  let formData = {};\r\n  for(let i=0;i<$('.form-bind-data').length;i++){\r\n    formData[$('.form-bind-data').eq(i).attr('name')]=$('.form-bind-data').eq(i).val()\r\n  }\r\n\r\n  // 抓items用的\r\n  for (let i = 0; i < $('.items-box').length; i++) {\r\n    // 將每個items-box抓出來，宣告陣列\r\n    let itemBoxKey = $('.items-box').eq(i).attr('data-itemKey')\r\n    formData[itemBoxKey]=[]\r\n    for (let j = 0; j < $('.items-box').eq(i).find('.items').length; j++) {\r\n      // 將items-box裡面有幾個items抓出來，並宣告物件\r\n      formData[itemBoxKey][j]={}\r\n      let formBindItems = $('.items-box').eq(i).find('.items').eq(j).find('.form-bind-items-data')\r\n      for (let k = 0; k < formBindItems.length; k++) {\r\n        // 抓出items裡面有幾個需綁定的.form-bind-items-data，並綁定到該位置\r\n        formData[itemBoxKey][j][formBindItems.eq(k).attr('name')]=formBindItems.eq(k).val()\r\n      }\r\n    }\r\n  }\r\n  for(let i=0;i<$('select').length;i++){\r\n    formData[$('select').eq(i).attr('name')]=parseInt($('select').eq(i).val())?true:false;\r\n  }\r\n  console.log(formData)\r\n    \r\n  $('body').LoadingOverlay(\"show\");\r\n\r\n  $.ajax({\r\n    url: `${apiDomain}${apiUrl}${isCreate}`,\r\n    type: method,\r\n    dataType : 'json', // 預期從server接收的資料型態\r\n    contentType : 'application/json; charset=utf-8', // 要送到server的資料型態\r\n    data: JSON.stringify(formData),\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    window.location.href = data.nextTo;\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction bindEvent(data) {\r\n  // Fetch all the forms we want to apply custom Bootstrap validation styles to\r\n  let forms = document.querySelectorAll('.needs-validation')\r\n\r\n  // Loop over them and prevent submission\r\n  Array.prototype.slice.call(forms)\r\n    .forEach(function (form) {\r\n      form.addEventListener('submit', function (event) {\r\n        if (!form.checkValidity()) {\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          form.classList.add('was-validated')\r\n        }else{\r\n          console.log(\"OK\")\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          console.log(isPreview)\r\n          sendFormData(data)\r\n        }\r\n\r\n      }, false)\r\n    })\r\n}\r\n\r\nfunction getUrlQuery(key) {\r\n  let url = location.href;\r\n  let val = \"\";\r\n\r\n  if(url.indexOf('?')!=-1){\r\n    let ary = url.split('?')[1].split('&');\r\n\r\n    for(let i=0;i<=ary.length-1;i++){\r\n      if(ary[i].split('=')[0] == key){\r\n        val = ary[i].split('=')[1];\r\n      }\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction uploadFile(fileInput) {\r\n  var form = new FormData();\r\n  form.append(\"file\", fileInput.files[0], \"json.png\");\r\n\r\n  var settings = {\r\n  };\r\n  $('body').LoadingOverlay(\"show\");\r\n\r\n  $.ajax({\r\n    \"url\": \"http://kiwi.ponitor.com.tw/api/v1/file/upload\",\r\n    \"method\": \"POST\",\r\n    \"timeout\": 0,\r\n    \"processData\": false,\r\n    \"mimeType\": \"multipart/form-data\",\r\n    \"contentType\": false,\r\n    \"data\": form\r\n  }).done(function (data) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    fileInput.nextElementSibling.value=JSON.parse(data).data.img\r\n    console.log($(`.${$(fileInput).attr('imgClass')}`))\r\n    $(fileInput).parent('.col-md-12').find(`.${$(fileInput).attr('imgClass')}`).attr('src',JSON.parse(data).data.img)\r\n    return JSON.parse(data).data.img\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction deleteApi(params) {\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${params.apiUrl}/${params.id}`,\r\n    type: 'delete',\r\n    dataType : 'json', // 預期從server接收的資料型態\r\n    contentType : 'application/json; charset=utf-8', // 要送到server的資料型態\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    location.reload();\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\n$(document).ready(function () {\r\n  let user = localStorage.getItem('user');\r\n\r\n  // console.log(user)\r\n  if(user==null&&window.location.pathname.indexOf('login.html')<0){\r\n    window.location.href = `login.html`;\r\n  }\r\n\r\n  $(\"input[type='file']\").on('change',function () {\r\n    console.log(\"upload file\")\r\n    uploadFile($(this)[0])\r\n  })\r\n\r\n  $('header .logout').on('click',function () {\r\n    localStorage.removeItem('user');\r\n    window.location.href = `login.html`;\r\n  })\r\n\r\n  $('.btn-add').on('click',function () {\r\n    // console.log($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    // console.log($(this).prev('.items-box'))\r\n    $(this).prev('.items-box').append($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    $(\"input[type='file']\").on('change',function () {\r\n      // console.log(\"upload file\")\r\n      uploadFile($(this)[0])\r\n    })\r\n  })\r\n\r\n})"]}