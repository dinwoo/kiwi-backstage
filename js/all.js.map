{"version":3,"sources":["all.js"],"names":["apiDomain","isPreview","sendFormData","data","apiUrl","isMainPage","isCreate","formData","isPublish","isDraft","i","$","length","eq","attr","parseInt","val","itemBoxKey","j","find","formBindItems","k","LoadingOverlay","console","url","concat","ajax","method","type","dataType","stringify","done","res","contentType","log","JSON","window","alert","bindEvent","forms","document","querySelectorAll","Array","prototype","slice","call","forEach","form","addEventListener","event","classList","preventDefault","checkValidity","getUrlQuery","key","location","indexOf","split","ary","uploadFile","fileInput","files","name","timeout","processData","mimeType","nextElementSibling","value","parse","img","parent","fail","deleteApi","params","id","ready","getItem","user","pathname","href","text","on","this","localStorage","removeItem","prev","append","html"],"mappings":"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","file":"all.js","sourcesContent":["// Example starter JavaScript for disabling form submissions if there are invalid fields\r\nlet apiDomain = 'http://kiwi.ponitor.com.tw';\r\nlet isPreview = false;\r\nlet isPublish;\r\nlet apiUrl = '';\r\n\r\n\r\nfunction sendFormData(data) {\r\n  // console.log(data)\r\n  apiUrl = data.apiUrl;\r\n  let isCreate = data.isMainPage ? \"\" : data.isCreate ? '/create' : \"/update\";\r\n  let method = data.isCreate || data.isMainPage ? 'post' : \"put\";\r\n\r\n  // let dataForm = document.getElementById('dataForm');\r\n  // let formData = new FormData(dataForm);\r\n\r\n  // //檢查formdata值\r\n  // let object = {};\r\n  // formData.forEach((value, key) => { object[key] = value });\r\n  // let json = JSON.stringify(object);\r\n  // console.log('formfata:'+json);\r\n\r\n\r\n  let formData = {};\r\n  if(data.isMainPage){\r\n    formData.isPublish=isPublish\r\n    formData.isDraft=!isPublish\r\n  }\r\n  for (let i = 0; i < $('.form-bind-data').length; i++) {\r\n    if($('.form-bind-data').eq(i).attr('type')=='number'){\r\n      formData[$('.form-bind-data').eq(i).attr('name')] = parseInt($('.form-bind-data').eq(i).val())\r\n    }else{\r\n      formData[$('.form-bind-data').eq(i).attr('name')] = $('.form-bind-data').eq(i).val()\r\n    }\r\n  }\r\n\r\n  // 抓items用的\r\n  for (let i = 0; i < $('.items-box').length; i++) {\r\n    // 將每個items-box抓出來，宣告陣列\r\n    let itemBoxKey = $('.items-box').eq(i).attr('data-itemKey')\r\n    formData[itemBoxKey] = []\r\n    for (let j = 0; j < $('.items-box').eq(i).find('.items').length; j++) {\r\n      // 將items-box裡面有幾個items抓出來，並宣告物件\r\n      formData[itemBoxKey][j] = {}\r\n      let formBindItems = $('.items-box').eq(i).find('.items').eq(j).find('.form-bind-items-data')\r\n      for (let k = 0; k < formBindItems.length; k++) {\r\n        // 抓出items裡面有幾個需綁定的.form-bind-items-data，並綁定到該位置\r\n        formData[itemBoxKey][j][formBindItems.eq(k).attr('name')] = formBindItems.eq(k).val()\r\n      }\r\n    }\r\n  }\r\n  for (let i = 0; i < $('select').length; i++) {\r\n    formData[$('select').eq(i).attr('name')] = parseInt($('select').eq(i).val()) ? true : false;\r\n  }\r\n  console.log(formData)\r\n\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${apiUrl}${isCreate}`,\r\n    type: method,\r\n    dataType: 'json', // 預期從server接收的資料型態\r\n    contentType: 'application/json; charset=utf-8', // 要送到server的資料型態\r\n    data: JSON.stringify(formData),\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    window.location.href = data.nextTo;\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction bindEvent(data) {\r\n  // Fetch all the forms we want to apply custom Bootstrap validation styles to\r\n  let forms = document.querySelectorAll('.needs-validation')\r\n\r\n  // Loop over them and prevent submission\r\n  Array.prototype.slice.call(forms)\r\n    .forEach(function (form) {\r\n      form.addEventListener('submit', function (event) {\r\n        if (!form.checkValidity()) {\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          form.classList.add('was-validated')\r\n        } else {\r\n          console.log(\"OK\")\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          sendFormData(data)\r\n        }\r\n\r\n      }, false)\r\n    })\r\n}\r\n\r\nfunction getUrlQuery(key) {\r\n  let url = location.href;\r\n  let val = \"\";\r\n\r\n  if (url.indexOf('?') != -1) {\r\n    let ary = url.split('?')[1].split('&');\r\n\r\n    for (let i = 0; i <= ary.length - 1; i++) {\r\n      if (ary[i].split('=')[0] == key) {\r\n        val = ary[i].split('=')[1];\r\n      }\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction uploadFile(fileInput) {\r\n  if (!fileInput.files[0]) return false\r\n  var form = new FormData();\r\n  form.append(\"file\", fileInput.files[0], fileInput.files[0].name);\r\n\r\n  var settings = {\r\n  };\r\n  $('body').LoadingOverlay(\"show\");\r\n\r\n  $.ajax({\r\n    \"url\": \"http://kiwi.ponitor.com.tw/api/v1/file/upload\",\r\n    \"method\": \"POST\",\r\n    \"timeout\": 0,\r\n    \"processData\": false,\r\n    \"mimeType\": \"multipart/form-data\",\r\n    \"contentType\": false,\r\n    \"data\": form\r\n  }).done(function (data) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    $(fileInput).attr('required', false)\r\n    fileInput.nextElementSibling.value = JSON.parse(data).data.img\r\n    console.log($(`.${$(fileInput).attr('imgClass')}`))\r\n    $(fileInput).parent('.col-md-12').find(`.${$(fileInput).attr('imgClass')}`).attr('src', JSON.parse(data).data.img)\r\n    return JSON.parse(data).data.img\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction deleteApi(params) {\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${params.apiUrl}/${params.id}`,\r\n    type: 'delete',\r\n    dataType: 'json', // 預期從server接收的資料型態\r\n    contentType: 'application/json; charset=utf-8', // 要送到server的資料型態\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    location.reload();\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\n$(document).ready(function () {\r\n  let user = localStorage.getItem('user');\r\n\r\n  if (user == null && window.location.pathname.indexOf('login.html') < 0) {\r\n    window.location.href = `login.html`;\r\n  } else {\r\n    $('header .user-name span').text(user)\r\n  }\r\n\r\n  $(\"input[type='file']\").on('change', function () {\r\n    console.log(\"upload file\")\r\n    uploadFile($(this)[0])\r\n  })\r\n\r\n  $('header .logout').on('click', function () {\r\n    localStorage.removeItem('user');\r\n    window.location.href = `login.html`;\r\n  })\r\n\r\n  $('.btn-add').on('click', function () {\r\n    // console.log($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    // console.log($(this).prev('.items-box'))\r\n    $(this).prev('.items-box').append($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    $(\"input[type='file']\").on('change', function () {\r\n      // console.log(\"upload file\")\r\n      uploadFile($(this)[0])\r\n    })\r\n  })\r\n\r\n})"]}