{"version":3,"sources":["all.js"],"names":["apiDomain","isPreview","sendFormData","data","apiUrl","isMainPage","isCreate","formData","isPublish","isDraft","i","$","length","eq","attr","parseInt","val","itemBoxKey","j","find","formBindItems","k","formBindSelects","years","months","monthItems","log","console","url","concat","type","method","dataType","contentType","done","LoadingOverlay","ajax","res","href","nextTo","alert","fail","document","querySelectorAll","slice","call","forms","forEach","form","addEventListener","event","checkValidity","prototype","preventDefault","bindEvent","stopPropagation","location","indexOf","ary","split","key","uploadFile","fileInput","files","FormData","append","name","timeout","mimeType","JSON","parse","img","nextElementSibling","deleteApi","params","id","reload","ready","getItem","user","window","pathname","text","this","on","localStorage","removeItem","prev","html"],"mappings":"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","file":"all.js","sourcesContent":["// Example starter JavaScript for disabling form submissions if there are invalid fields\r\nlet apiDomain = 'http://kiwi.ponitor.com.tw';\r\nlet isPreview = false;\r\nlet isPublish;\r\nlet apiUrl = '';\r\n\r\n\r\nfunction sendFormData(data) {\r\n  // console.log(data)\r\n  apiUrl = data.apiUrl;\r\n  let isCreate = data.isMainPage ? \"\" : data.isCreate ? '/create' : \"/update\";\r\n  let method = data.isCreate || data.isMainPage ? 'post' : \"put\";\r\n\r\n  // let dataForm = document.getElementById('dataForm');\r\n  // let formData = new FormData(dataForm);\r\n\r\n  // //檢查formdata值\r\n  // let object = {};\r\n  // formData.forEach((value, key) => { object[key] = value });\r\n  // let json = JSON.stringify(object);\r\n  // console.log('formfata:'+json);\r\n\r\n\r\n  let formData = {};\r\n  if(data.isMainPage){\r\n    formData.isPublish=isPublish\r\n    formData.isDraft=!isPublish\r\n  }\r\n  for (let i = 0; i < $('.form-bind-data').length; i++) {\r\n    if($('.form-bind-data').eq(i).attr('type')=='number'){\r\n      formData[$('.form-bind-data').eq(i).attr('name')] = parseInt($('.form-bind-data').eq(i).val())\r\n    }else{\r\n      formData[$('.form-bind-data').eq(i).attr('name')] = $('.form-bind-data').eq(i).val()\r\n    }\r\n  }\r\n\r\n  // 抓items用的\r\n  for (let i = 0; i < $('.items-box').length; i++) {\r\n    // 將每個items-box抓出來，宣告陣列\r\n    let itemBoxKey = $('.items-box').eq(i).attr('data-itemKey')\r\n    formData[itemBoxKey] = []\r\n    for (let j = 0; j < $('.items-box').eq(i).find('.items').length; j++) {\r\n      // 將items-box裡面有幾個items抓出來，並宣告物件\r\n      formData[itemBoxKey][j] = {}\r\n      let formBindItems = $('.items-box').eq(i).find('.items').eq(j).find('.form-bind-items-data')\r\n      for (let k = 0; k < formBindItems.length; k++) {\r\n        // 抓出items裡面有幾個需綁定的.form-bind-items-data，並綁定到該位置\r\n        formData[itemBoxKey][j][formBindItems.eq(k).attr('name')] = formBindItems.eq(k).val()\r\n      }\r\n      let formBindSelects = $('.items-box').eq(i).find('.items').eq(j).find('.form-bind-items-select')\r\n      for (let k = 0; k < formBindSelects.length; k++) {\r\n        // 抓出items裡面有幾個需綁定的.form-bind-items-data，並綁定到該位置\r\n        formData[itemBoxKey][j][formBindSelects.eq(k).attr('name')] = parseInt(formBindSelects.eq(k).val()) ? true : false;\r\n      }\r\n    }\r\n  }\r\n  for (let i = 0; i < $('select').length; i++) {\r\n    formData[$('select').eq(i).attr('name')] = parseInt($('select').eq(i).val()) ? true : false;\r\n  }\r\n\r\n  let years = $('.years-box .years')\r\n  if(years.length) formData['year_items']=[]\r\n  for (let i = 0; i < years.length; i++) {\r\n    let months = $(years[i]).find('.months')\r\n    formData['year_items'][i]={}\r\n    formData['year_items'][i]['year_item_year'] = $(years[i]).find('.form-bind-years-data').val();\r\n    formData['year_items'][i]['year_item_items']=[]\r\n    for (let j = 0; j < months.length; j++) {\r\n      let monthItems =$(months[j]).find('.form-bind-months-data')\r\n      formData['year_items'][i]['year_item_items'][j]={}\r\n      for (let k = 0; k < monthItems.length; k++) {\r\n        console.log(monthItems.eq(k).attr('name'))      \r\n        formData['year_items'][i]['year_item_items'][j][monthItems.eq(k).attr('name')]=monthItems.eq(k).val()\r\n      }\r\n    }\r\n  }\r\n  console.log(formData)\r\n\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${apiUrl}${isCreate}`,\r\n    type: method,\r\n    dataType: 'json', // 預期從server接收的資料型態\r\n    contentType: 'application/json; charset=utf-8', // 要送到server的資料型態\r\n    data: JSON.stringify(formData),\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    window.location.href = data.nextTo;\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction bindEvent(data) {\r\n  // Fetch all the forms we want to apply custom Bootstrap validation styles to\r\n  let forms = document.querySelectorAll('.needs-validation')\r\n\r\n  // Loop over them and prevent submission\r\n  Array.prototype.slice.call(forms)\r\n    .forEach(function (form) {\r\n      form.addEventListener('submit', function (event) {\r\n        if (!form.checkValidity()) {\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          form.classList.add('was-validated')\r\n        } else {\r\n          console.log(\"OK\")\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          sendFormData(data)\r\n        }\r\n\r\n      }, false)\r\n    })\r\n}\r\n\r\nfunction getUrlQuery(key) {\r\n  let url = location.href;\r\n  let val = \"\";\r\n\r\n  if (url.indexOf('?') != -1) {\r\n    let ary = url.split('?')[1].split('&');\r\n\r\n    for (let i = 0; i <= ary.length - 1; i++) {\r\n      if (ary[i].split('=')[0] == key) {\r\n        val = ary[i].split('=')[1];\r\n      }\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction uploadFile(fileInput) {\r\n  if (!fileInput.files[0]) return false\r\n  var form = new FormData();\r\n  form.append(\"file\", fileInput.files[0], fileInput.files[0].name);\r\n\r\n  var settings = {\r\n  };\r\n  $('body').LoadingOverlay(\"show\");\r\n\r\n  $.ajax({\r\n    \"url\": \"http://kiwi.ponitor.com.tw/api/v1/file/upload\",\r\n    \"method\": \"POST\",\r\n    \"timeout\": 0,\r\n    \"processData\": false,\r\n    \"mimeType\": \"multipart/form-data\",\r\n    \"contentType\": false,\r\n    \"data\": form\r\n  }).done(function (data) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    $(fileInput).attr('required', false)\r\n    fileInput.nextElementSibling.value = JSON.parse(data).data.img\r\n    console.log($(`.${$(fileInput).attr('imgClass')}`))\r\n    $(fileInput).parent('.col-md-12').find(`.${$(fileInput).attr('imgClass')}`).attr('src', JSON.parse(data).data.img)\r\n    return JSON.parse(data).data.img\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction deleteApi(params) {\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${params.apiUrl}/${params.id}`,\r\n    type: 'delete',\r\n    dataType: 'json', // 預期從server接收的資料型態\r\n    contentType: 'application/json; charset=utf-8', // 要送到server的資料型態\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    location.reload();\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\n$(document).ready(function () {\r\n  let user = localStorage.getItem('user');\r\n\r\n  if (user == null && window.location.pathname.indexOf('login.html') < 0) {\r\n    window.location.href = `login.html`;\r\n  } else {\r\n    $('header .user-name span').text(user)\r\n  }\r\n\r\n  $(\"input[type='file']\").on('change', function () {\r\n    console.log(\"upload file\")\r\n    uploadFile($(this)[0])\r\n  })\r\n\r\n  $('header .logout').on('click', function () {\r\n    localStorage.removeItem('user');\r\n    window.location.href = `login.html`;\r\n  })\r\n\r\n  $('.btn-add').on('click', function () {\r\n    // console.log($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    // console.log($(this).prev('.items-box'))\r\n    $(this).prev('.items-box').append($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    $(\"input[type='file']\").on('change', function () {\r\n      // console.log(\"upload file\")\r\n      uploadFile($(this)[0])\r\n    })\r\n  })\r\n\r\n})"]}