{"version":3,"sources":["all.js"],"names":["apiDomain","isPreview","sendFormData","data","apiUrl","isMainPage","isCreate","formData","isPublish","isDraft","i","$","length","eq","attr","parseInt","val","itemBoxKey","j","find","formBindItems","k","years","months","monthItems","console","log","LoadingOverlay","ajax","url","concat","type","method","contentType","JSON","stringify","dataType","res","window","location","href","nextTo","alert","bindEvent","querySelectorAll","Array","prototype","slice","call","forms","forEach","form","event","checkValidity","preventDefault","stopPropagation","add","document","getUrlQuery","key","split","ary","indexOf","uploadFile","fileInput","files","FormData","append","name","settings","timeout","processData","mimeType","done","value","parse","img","nextElementSibling","fail","parent","deleteApi","params","id","reload","ready","user","localStorage","getItem","pathname","text","on","this","removeItem","prev","html"],"mappings":"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","file":"all.js","sourcesContent":["// Example starter JavaScript for disabling form submissions if there are invalid fields\r\nlet apiDomain = 'http://kiwi.ponitor.com.tw';\r\nlet isPreview = false;\r\nlet isPublish;\r\nlet apiUrl = '';\r\n\r\n\r\nfunction sendFormData(data) {\r\n  // console.log(data)\r\n  apiUrl = data.apiUrl;\r\n  let isCreate = data.isMainPage ? \"\" : data.isCreate ? '/create' : \"/update\";\r\n  let method = data.isCreate || data.isMainPage ? 'post' : \"put\";\r\n\r\n  // let dataForm = document.getElementById('dataForm');\r\n  // let formData = new FormData(dataForm);\r\n\r\n  // //檢查formdata值\r\n  // let object = {};\r\n  // formData.forEach((value, key) => { object[key] = value });\r\n  // let json = JSON.stringify(object);\r\n  // console.log('formfata:'+json);\r\n\r\n\r\n  let formData = {};\r\n  if(data.isMainPage){\r\n    formData.isPublish=isPublish\r\n    formData.isDraft=!isPublish\r\n  }\r\n  for (let i = 0; i < $('.form-bind-data').length; i++) {\r\n    if($('.form-bind-data').eq(i).attr('type')=='number'){\r\n      formData[$('.form-bind-data').eq(i).attr('name')] = parseInt($('.form-bind-data').eq(i).val())\r\n    }else{\r\n      formData[$('.form-bind-data').eq(i).attr('name')] = $('.form-bind-data').eq(i).val()\r\n    }\r\n  }\r\n\r\n  // 抓items用的\r\n  for (let i = 0; i < $('.items-box').length; i++) {\r\n    // 將每個items-box抓出來，宣告陣列\r\n    let itemBoxKey = $('.items-box').eq(i).attr('data-itemKey')\r\n    formData[itemBoxKey] = []\r\n    for (let j = 0; j < $('.items-box').eq(i).find('.items').length; j++) {\r\n      // 將items-box裡面有幾個items抓出來，並宣告物件\r\n      formData[itemBoxKey][j] = {}\r\n      let formBindItems = $('.items-box').eq(i).find('.items').eq(j).find('.form-bind-items-data')\r\n      for (let k = 0; k < formBindItems.length; k++) {\r\n        // 抓出items裡面有幾個需綁定的.form-bind-items-data，並綁定到該位置\r\n        formData[itemBoxKey][j][formBindItems.eq(k).attr('name')] = formBindItems.eq(k).val()\r\n      }\r\n    }\r\n  }\r\n  for (let i = 0; i < $('select').length; i++) {\r\n    formData[$('select').eq(i).attr('name')] = parseInt($('select').eq(i).val()) ? true : false;\r\n  }\r\n\r\n  let years = $('.years-box .years')\r\n  if(years.length) formData['year_items']=[]\r\n  for (let i = 0; i < years.length; i++) {\r\n    let months = $(years[i]).find('.months')\r\n    formData['year_items'][i]={}\r\n    formData['year_items'][i]['year_item_year'] = $(years[i]).find('.form-bind-years-data').val();\r\n    formData['year_items'][i]['year_item_items']=[]\r\n    for (let j = 0; j < months.length; j++) {\r\n      let monthItems =$(months[j]).find('.form-bind-months-data')\r\n      formData['year_items'][i]['year_item_items'][j]={}\r\n      for (let k = 0; k < monthItems.length; k++) {\r\n        console.log(monthItems.eq(k).attr('name'))      \r\n        formData['year_items'][i]['year_item_items'][j][monthItems.eq(k).attr('name')]=monthItems.eq(k).val()\r\n      }\r\n    }\r\n  }\r\n  console.log(formData)\r\n\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${apiUrl}${isCreate}`,\r\n    type: method,\r\n    dataType: 'json', // 預期從server接收的資料型態\r\n    contentType: 'application/json; charset=utf-8', // 要送到server的資料型態\r\n    data: JSON.stringify(formData),\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    window.location.href = data.nextTo;\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction bindEvent(data) {\r\n  // Fetch all the forms we want to apply custom Bootstrap validation styles to\r\n  let forms = document.querySelectorAll('.needs-validation')\r\n\r\n  // Loop over them and prevent submission\r\n  Array.prototype.slice.call(forms)\r\n    .forEach(function (form) {\r\n      form.addEventListener('submit', function (event) {\r\n        if (!form.checkValidity()) {\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          form.classList.add('was-validated')\r\n        } else {\r\n          console.log(\"OK\")\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          sendFormData(data)\r\n        }\r\n\r\n      }, false)\r\n    })\r\n}\r\n\r\nfunction getUrlQuery(key) {\r\n  let url = location.href;\r\n  let val = \"\";\r\n\r\n  if (url.indexOf('?') != -1) {\r\n    let ary = url.split('?')[1].split('&');\r\n\r\n    for (let i = 0; i <= ary.length - 1; i++) {\r\n      if (ary[i].split('=')[0] == key) {\r\n        val = ary[i].split('=')[1];\r\n      }\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction uploadFile(fileInput) {\r\n  if (!fileInput.files[0]) return false\r\n  var form = new FormData();\r\n  form.append(\"file\", fileInput.files[0], fileInput.files[0].name);\r\n\r\n  var settings = {\r\n  };\r\n  $('body').LoadingOverlay(\"show\");\r\n\r\n  $.ajax({\r\n    \"url\": \"http://kiwi.ponitor.com.tw/api/v1/file/upload\",\r\n    \"method\": \"POST\",\r\n    \"timeout\": 0,\r\n    \"processData\": false,\r\n    \"mimeType\": \"multipart/form-data\",\r\n    \"contentType\": false,\r\n    \"data\": form\r\n  }).done(function (data) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    $(fileInput).attr('required', false)\r\n    fileInput.nextElementSibling.value = JSON.parse(data).data.img\r\n    console.log($(`.${$(fileInput).attr('imgClass')}`))\r\n    $(fileInput).parent('.col-md-12').find(`.${$(fileInput).attr('imgClass')}`).attr('src', JSON.parse(data).data.img)\r\n    return JSON.parse(data).data.img\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction deleteApi(params) {\r\n  $('body').LoadingOverlay(\"show\");\r\n  $.ajax({\r\n    url: `${apiDomain}${params.apiUrl}/${params.id}`,\r\n    type: 'delete',\r\n    dataType: 'json', // 預期從server接收的資料型態\r\n    contentType: 'application/json; charset=utf-8', // 要送到server的資料型態\r\n  }).done(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    location.reload();\r\n  }).fail(function (res) {\r\n    $('body').LoadingOverlay(\"hide\");\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\n$(document).ready(function () {\r\n  let user = localStorage.getItem('user');\r\n\r\n  if (user == null && window.location.pathname.indexOf('login.html') < 0) {\r\n    window.location.href = `login.html`;\r\n  } else {\r\n    $('header .user-name span').text(user)\r\n  }\r\n\r\n  $(\"input[type='file']\").on('change', function () {\r\n    console.log(\"upload file\")\r\n    uploadFile($(this)[0])\r\n  })\r\n\r\n  $('header .logout').on('click', function () {\r\n    localStorage.removeItem('user');\r\n    window.location.href = `login.html`;\r\n  })\r\n\r\n  $('.btn-add').on('click', function () {\r\n    // console.log($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    // console.log($(this).prev('.items-box'))\r\n    $(this).prev('.items-box').append($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    $(\"input[type='file']\").on('change', function () {\r\n      // console.log(\"upload file\")\r\n      uploadFile($(this)[0])\r\n    })\r\n  })\r\n\r\n})"]}