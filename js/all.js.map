{"version":3,"sources":["all.js"],"names":["apiDomain","isPreview","sendFormData","data","apiUrl","isCreate","formData","i","$","length","eq","attr","val","itemBoxKey","j","find","formBindItems","k","parseInt","console","log","ajax","url","concat","type","method","dataType","contentType","stringify","done","res","JSON","window","location","nextTo","alert","bindEvent","forms","querySelectorAll","Array","prototype","slice","call","form","addEventListener","event","checkValidity","preventDefault","stopPropagation","classList","add","getUrlQuery","href","ary","split","key","uploadFile","fileInput","FormData","append","files","timeout","processData","mimeType","nextElementSibling","parent","img","parse","fail","deleteApi","params","id","reload","document","ready","localStorage","getItem","pathname","indexOf","on","this","removeItem","html"],"mappings":"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","file":"all.js","sourcesContent":["// Example starter JavaScript for disabling form submissions if there are invalid fields\r\nlet apiDomain= 'http://kiwi.ponitor.com.tw';\r\nlet isPreview = false;\r\nlet apiUrl = '';\r\n\r\n\r\nfunction sendFormData(data) {\r\n  // console.log(data)\r\n  apiUrl = data.apiUrl;\r\n  let isCreate = data.isCreate?'create':\"update\";\r\n  let method = data.isCreate?'post':\"put\";\r\n\r\n  // let dataForm = document.getElementById('dataForm');\r\n  // let formData = new FormData(dataForm);\r\n\r\n  // //檢查formdata值\r\n  // let object = {};\r\n  // formData.forEach((value, key) => { object[key] = value });\r\n  // let json = JSON.stringify(object);\r\n  // console.log('formfata:'+json);\r\n\r\n  \r\n  let formData = {};\r\n  for(let i=0;i<$('.form-bind-data').length;i++){\r\n    formData[$('.form-bind-data').eq(i).attr('name')]=$('.form-bind-data').eq(i).val()\r\n  }\r\n\r\n  // 抓items用的\r\n  for (let i = 0; i < $('.items-box').length; i++) {\r\n    // 將每個items-box抓出來，宣告陣列\r\n    let itemBoxKey = $('.items-box').eq(i).attr('data-itemKey')\r\n    formData[itemBoxKey]=[]\r\n    for (let j = 0; j < $('.items-box').eq(i).find('.items').length; j++) {\r\n      // 將items-box裡面有幾個items抓出來，並宣告物件\r\n      formData[itemBoxKey][j]={}\r\n      let formBindItems = $('.items-box').eq(i).find('.items').eq(j).find('.form-bind-items-data')\r\n      for (let k = 0; k < formBindItems.length; k++) {\r\n        // 抓出items裡面有幾個需綁定的.form-bind-items-data，並綁定到該位置\r\n        formData[itemBoxKey][j][formBindItems.eq(k).attr('name')]=formBindItems.eq(k).val()\r\n      }\r\n    }\r\n  }\r\n  for(let i=0;i<$('select').length;i++){\r\n    formData[$('select').eq(i).attr('name')]=parseInt($('select').eq(i).val())?true:false;\r\n  }\r\n  console.log(formData)\r\n    \r\n\r\n  $.ajax({\r\n    url: `${apiDomain}${apiUrl}/${isCreate}`,\r\n    type: method,\r\n    dataType : 'json', // 預期從server接收的資料型態\r\n    contentType : 'application/json; charset=utf-8', // 要送到server的資料型態\r\n    data: JSON.stringify(formData),\r\n  }).done(function (res) {\r\n    console.log(res);\r\n    window.location.href = data.nextTo;\r\n  }).fail(function (res) {\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction bindEvent(data) {\r\n  // Fetch all the forms we want to apply custom Bootstrap validation styles to\r\n  let forms = document.querySelectorAll('.needs-validation')\r\n\r\n  // Loop over them and prevent submission\r\n  Array.prototype.slice.call(forms)\r\n    .forEach(function (form) {\r\n      form.addEventListener('submit', function (event) {\r\n        if (!form.checkValidity()) {\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          form.classList.add('was-validated')\r\n        }else{\r\n          console.log(\"OK\")\r\n          event.preventDefault()\r\n          event.stopPropagation()\r\n          console.log(isPreview)\r\n          sendFormData(data)\r\n        }\r\n\r\n      }, false)\r\n    })\r\n}\r\n\r\nfunction getUrlQuery(key) {\r\n  let url = location.href;\r\n  let val = \"\";\r\n\r\n  if(url.indexOf('?')!=-1){\r\n    let ary = url.split('?')[1].split('&');\r\n\r\n    for(let i=0;i<=ary.length-1;i++){\r\n      if(ary[i].split('=')[0] == key){\r\n        val = ary[i].split('=')[1];\r\n      }\r\n    }\r\n  }\r\n  return val;\r\n}\r\n\r\nfunction uploadFile(fileInput) {\r\n  var form = new FormData();\r\n  form.append(\"file\", fileInput.files[0], \"json.png\");\r\n\r\n  var settings = {\r\n  };\r\n\r\n  $.ajax({\r\n    \"url\": \"http://kiwi.ponitor.com.tw/api/v1/file/upload\",\r\n    \"method\": \"POST\",\r\n    \"timeout\": 0,\r\n    \"processData\": false,\r\n    \"mimeType\": \"multipart/form-data\",\r\n    \"contentType\": false,\r\n    \"data\": form\r\n  }).done(function (data) {\r\n    fileInput.nextElementSibling.value=JSON.parse(data).data.img\r\n    console.log($(`.${$(fileInput).attr('imgClass')}`))\r\n    $(fileInput).parent('.col-md-12').find(`.${$(fileInput).attr('imgClass')}`).attr('src',JSON.parse(data).data.img)\r\n    return JSON.parse(data).data.img\r\n  }).fail(function (res) {\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\nfunction deleteApi(params) {\r\n  $.ajax({\r\n    url: `${apiDomain}${params.apiUrl}/${params.id}`,\r\n    type: 'delete',\r\n    dataType : 'json', // 預期從server接收的資料型態\r\n    contentType : 'application/json; charset=utf-8', // 要送到server的資料型態\r\n  }).done(function (res) {\r\n    console.log(res);\r\n    location.reload();\r\n  }).fail(function (res) {\r\n    console.log(res);\r\n    alert('操作失敗');\r\n  });\r\n}\r\n\r\n$(document).ready(function () {\r\n  let user = localStorage.getItem('user');\r\n  // console.log(user)\r\n  if(user==null&&window.location.pathname.indexOf('login.html')<0){\r\n    window.location.href = `login.html`;\r\n  }\r\n\r\n  $(\"input[type='file']\").on('change',function () {\r\n    console.log(\"upload file\")\r\n    uploadFile($(this)[0])\r\n  })\r\n\r\n  $('header .logout').on('click',function () {\r\n    localStorage.removeItem('user');\r\n    window.location.href = `login.html`;\r\n  })\r\n\r\n  $('.btn-add').on('click',function () {\r\n    // console.log($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    // console.log($(this).prev('.items-box'))\r\n    $(this).prev('.items-box').append($(`.hidde-box .${$(this).data('copy')}`).html())\r\n    $(\"input[type='file']\").on('change',function () {\r\n      // console.log(\"upload file\")\r\n      uploadFile($(this)[0])\r\n    })\r\n  })\r\n\r\n})"]}