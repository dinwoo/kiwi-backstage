"use strict";var isPublish,apiDomain="http://kiwi.ponitor.com.tw",isPreview=!1,apiUrl="";function sendFormData(a){apiUrl=a.apiUrl;var e=a.isMainPage?"":a.isCreate?"/create":"/update",t=a.isCreate||a.isMainPage?"post":"put",i={};a.isMainPage&&(i.isPublish=isPublish,i.isDraft=!isPublish);for(var o=0;o<$(".form-bind-data").length;o++)"number"==$(".form-bind-data").eq(o).attr("type")?i[$(".form-bind-data").eq(o).attr("name")]=parseInt($(".form-bind-data").eq(o).val()):i[$(".form-bind-data").eq(o).attr("name")]=$(".form-bind-data").eq(o).val();for(var n=0;n<$(".items-box").length;n++){var r=$(".items-box").eq(n).attr("data-itemKey");i[r]=[];for(var l=0;l<$(".items-box").eq(n).find(".items").length;l++){i[r][l]={};for(var d=$(".items-box").eq(n).find(".items").eq(l).find(".form-bind-items-data"),s=0;s<d.length;s++)i[r][l][d.eq(s).attr("name")]=d.eq(s).val();for(var c=$(".items-box").eq(n).find(".items").eq(l).find(".form-bind-items-select"),m=0;m<c.length;m++)i[r][l][c.eq(m).attr("name")]=!!parseInt(c.eq(m).val())}}for(var f=0;f<$("select").length;f++)i[$("select").eq(f).attr("name")]=!!parseInt($("select").eq(f).val());var p=$(".years-box .years");p.length&&(i.year_items=[]);for(var u=0;u<p.length;u++){var g=$(p[u]).find(".months");i.year_items[u]={},i.year_items[u].year_item_year=$(p[u]).find(".form-bind-years-data").val(),i.year_items[u].year_item_items=[];for(var y=0;y<g.length;y++){var h=$(g[y]).find(".form-bind-months-data");i.year_items[u].year_item_items[y]={};for(var v=0;v<h.length;v++)console.log(h.eq(v).attr("name")),i.year_items[u].year_item_items[y][h.eq(v).attr("name")]=h.eq(v).val()}}console.log(i),$("body").LoadingOverlay("show"),$.ajax({url:"".concat(apiDomain).concat(apiUrl).concat(e),type:t,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(i)}).done(function(e){$("body").LoadingOverlay("hide"),console.log(e),window.location.href=a.nextTo}).fail(function(e){$("body").LoadingOverlay("hide"),console.log(e),alert("操作失敗")})}function bindEvent(t){var e=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(e).forEach(function(a){a.addEventListener("submit",function(e){a.checkValidity()?(console.log("OK"),e.preventDefault(),e.stopPropagation(),sendFormData(t)):(e.preventDefault(),e.stopPropagation(),a.classList.add("was-validated"))},!1)})}function getUrlQuery(e){var a=location.href,t="";if(-1!=a.indexOf("?"))for(var i=a.split("?")[1].split("&"),o=0;o<=i.length-1;o++)i[o].split("=")[0]==e&&(t=i[o].split("=")[1]);return t}function uploadFile(a){if(!a.files[0])return!1;var e=new FormData;e.append("file",a.files[0],a.files[0].name);$("body").LoadingOverlay("show"),$.ajax({url:"http://kiwi.ponitor.com.tw/api/v1/file/upload",method:"POST",timeout:0,processData:!1,mimeType:"multipart/form-data",contentType:!1,data:e}).done(function(e){return $("body").LoadingOverlay("hide"),$(a).attr("required",!1),a.nextElementSibling.value=JSON.parse(e).data.img,console.log($(".".concat($(a).attr("imgClass")))),$(a).parent(".col-md-12").find(".".concat($(a).attr("imgClass"))).attr("src",JSON.parse(e).data.img),JSON.parse(e).data.img}).fail(function(e){$("body").LoadingOverlay("hide"),console.log(e),alert("操作失敗")})}function deleteApi(e){$("body").LoadingOverlay("show"),$.ajax({url:"".concat(apiDomain).concat(e.apiUrl,"/").concat(e.id),type:"delete",dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){$("body").LoadingOverlay("hide"),console.log(e),location.reload()}).fail(function(e){$("body").LoadingOverlay("hide"),console.log(e),alert("操作失敗")})}$(document).ready(function(){var e=localStorage.getItem("user");null==e&&window.location.pathname.indexOf("login.html")<0?window.location.href="login.html":$("header .user-name span").text(e),$("input[type='file']").on("change",function(){console.log("upload file"),uploadFile($(this)[0])}),$("header .logout").on("click",function(){localStorage.removeItem("user"),window.location.href="login.html"}),$(".btn-add").on("click",function(){$(this).prev(".items-box").append($(".hidde-box .".concat($(this).data("copy"))).html()),$("input[type='file']").on("change",function(){uploadFile($(this)[0])})})});
//# sourceMappingURL=all.js.map
