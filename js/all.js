"use strict";var isPublish,apiDomain="http://kiwi.ponitor.com.tw",isPreview=!1,apiUrl="";function sendFormData(a){apiUrl=a.apiUrl;var e=a.isMainPage?"":a.isCreate?"/create":"/update",t=a.isCreate||a.isMainPage?"post":"put",o={};a.isMainPage&&(o.isPublish=isPublish,o.isDraft=!isPublish);for(var i=0;i<$(".form-bind-data").length;i++)"number"==$(".form-bind-data").eq(i).attr("type")?o[$(".form-bind-data").eq(i).attr("name")]=parseInt($(".form-bind-data").eq(i).val()):o[$(".form-bind-data").eq(i).attr("name")]=$(".form-bind-data").eq(i).val();for(var n=0;n<$(".items-box").length;n++){var r=$(".items-box").eq(n).attr("data-itemKey");o[r]=[];for(var l=0;l<$(".items-box").eq(n).find(".items").length;l++){o[r][l]={};for(var d=$(".items-box").eq(n).find(".items").eq(l).find(".form-bind-items-data"),s=0;s<d.length;s++)o[r][l][d.eq(s).attr("name")]=d.eq(s).val()}}for(var c=0;c<$("select").length;c++)o[$("select").eq(c).attr("name")]=!!parseInt($("select").eq(c).val());var m=$(".years-box .years");m.length&&(o.year_items=[]);for(var f=0;f<m.length;f++){var p=$(m[f]).find(".months");o.year_items[f]={},o.year_items[f].year_item_year=$(m[f]).find(".form-bind-years-data").val(),o.year_items[f].year_item_items=[];for(var u=0;u<p.length;u++){var y=$(p[u]).find(".form-bind-months-data");o.year_items[f].year_item_items[u]={};for(var g=0;g<y.length;g++)console.log(y.eq(g).attr("name")),o.year_items[f].year_item_items[u][y.eq(g).attr("name")]=y.eq(g).val()}}console.log(o),$("body").LoadingOverlay("show"),$.ajax({url:"".concat(apiDomain).concat(apiUrl).concat(e),type:t,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(o)}).done(function(e){$("body").LoadingOverlay("hide"),console.log(e),window.location.href=a.nextTo}).fail(function(e){$("body").LoadingOverlay("hide"),console.log(e),alert("操作失敗")})}function bindEvent(t){var e=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(e).forEach(function(a){a.addEventListener("submit",function(e){a.checkValidity()?(console.log("OK"),e.preventDefault(),e.stopPropagation(),sendFormData(t)):(e.preventDefault(),e.stopPropagation(),a.classList.add("was-validated"))},!1)})}function getUrlQuery(e){var a=location.href,t="";if(-1!=a.indexOf("?"))for(var o=a.split("?")[1].split("&"),i=0;i<=o.length-1;i++)o[i].split("=")[0]==e&&(t=o[i].split("=")[1]);return t}function uploadFile(a){if(!a.files[0])return!1;var e=new FormData;e.append("file",a.files[0],a.files[0].name);$("body").LoadingOverlay("show"),$.ajax({url:"http://kiwi.ponitor.com.tw/api/v1/file/upload",method:"POST",timeout:0,processData:!1,mimeType:"multipart/form-data",contentType:!1,data:e}).done(function(e){return $("body").LoadingOverlay("hide"),$(a).attr("required",!1),a.nextElementSibling.value=JSON.parse(e).data.img,console.log($(".".concat($(a).attr("imgClass")))),$(a).parent(".col-md-12").find(".".concat($(a).attr("imgClass"))).attr("src",JSON.parse(e).data.img),JSON.parse(e).data.img}).fail(function(e){$("body").LoadingOverlay("hide"),console.log(e),alert("操作失敗")})}function deleteApi(e){$("body").LoadingOverlay("show"),$.ajax({url:"".concat(apiDomain).concat(e.apiUrl,"/").concat(e.id),type:"delete",dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(e){$("body").LoadingOverlay("hide"),console.log(e),location.reload()}).fail(function(e){$("body").LoadingOverlay("hide"),console.log(e),alert("操作失敗")})}$(document).ready(function(){var e=localStorage.getItem("user");null==e&&window.location.pathname.indexOf("login.html")<0?window.location.href="login.html":$("header .user-name span").text(e),$("input[type='file']").on("change",function(){console.log("upload file"),uploadFile($(this)[0])}),$("header .logout").on("click",function(){localStorage.removeItem("user"),window.location.href="login.html"}),$(".btn-add").on("click",function(){$(this).prev(".items-box").append($(".hidde-box .".concat($(this).data("copy"))).html()),$("input[type='file']").on("change",function(){uploadFile($(this)[0])})})});
//# sourceMappingURL=all.js.map
