"use strict";var isPublish,apiDomain="http://kiwi.ponitor.com.tw",isPreview=!1,apiUrl="";function sendFormData(e){apiUrl=e.apiUrl;var a=e.isMainPage?"":e.isCreate?"/create":"/update",t=e.isCreate||e.isMainPage?"post":"put",o={};e.isMainPage&&(o.isPublish=isPublish,o.isDraft=!isPublish);for(var i=0;i<$(".form-bind-data").length;i++)o[$(".form-bind-data").eq(i).attr("name")]=$(".form-bind-data").eq(i).val();for(var n=0;n<$(".items-box").length;n++){var l=$(".items-box").eq(n).attr("data-itemKey");o[l]=[];for(var r=0;r<$(".items-box").eq(n).find(".items").length;r++){o[l][r]={};for(var d=$(".items-box").eq(n).find(".items").eq(r).find(".form-bind-items-data"),c=0;c<d.length;c++)o[l][r][d.eq(c).attr("name")]=d.eq(c).val()}}for(var s=0;s<$("select").length;s++)o[$("select").eq(s).attr("name")]=!!parseInt($("select").eq(s).val());console.log(o),$("body").LoadingOverlay("show"),$.ajax({url:"".concat(apiDomain).concat(apiUrl).concat(a),type:t,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(o)}).done(function(a){$("body").LoadingOverlay("hide"),console.log(a),window.location.href=e.nextTo}).fail(function(a){$("body").LoadingOverlay("hide"),console.log(a),alert("操作失敗")})}function bindEvent(t){var a=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(a).forEach(function(e){e.addEventListener("submit",function(a){e.checkValidity()?(console.log("OK"),a.preventDefault(),a.stopPropagation(),sendFormData(t)):(a.preventDefault(),a.stopPropagation(),e.classList.add("was-validated"))},!1)})}function getUrlQuery(a){var e=location.href,t="";if(-1!=e.indexOf("?"))for(var o=e.split("?")[1].split("&"),i=0;i<=o.length-1;i++)o[i].split("=")[0]==a&&(t=o[i].split("=")[1]);return t}function uploadFile(e){if(!e.files[0])return!1;var a=new FormData;a.append("file",e.files[0],e.files[0].name);$("body").LoadingOverlay("show"),$.ajax({url:"http://kiwi.ponitor.com.tw/api/v1/file/upload",method:"POST",timeout:0,processData:!1,mimeType:"multipart/form-data",contentType:!1,data:a}).done(function(a){return $("body").LoadingOverlay("hide"),$(e).attr("required",!1),e.nextElementSibling.value=JSON.parse(a).data.img,console.log($(".".concat($(e).attr("imgClass")))),$(e).parent(".col-md-12").find(".".concat($(e).attr("imgClass"))).attr("src",JSON.parse(a).data.img),JSON.parse(a).data.img}).fail(function(a){$("body").LoadingOverlay("hide"),console.log(a),alert("操作失敗")})}function deleteApi(a){$("body").LoadingOverlay("show"),$.ajax({url:"".concat(apiDomain).concat(a.apiUrl,"/").concat(a.id),type:"delete",dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){$("body").LoadingOverlay("hide"),console.log(a),location.reload()}).fail(function(a){$("body").LoadingOverlay("hide"),console.log(a),alert("操作失敗")})}$(document).ready(function(){var a=localStorage.getItem("user");null==a&&window.location.pathname.indexOf("login.html")<0?window.location.href="login.html":$("header .user-name span").text(a),$("input[type='file']").on("change",function(){console.log("upload file"),uploadFile($(this)[0])}),$("header .logout").on("click",function(){localStorage.removeItem("user"),window.location.href="login.html"}),$(".btn-add").on("click",function(){$(this).prev(".items-box").append($(".hidde-box .".concat($(this).data("copy"))).html()),$("input[type='file']").on("change",function(){uploadFile($(this)[0])})})});
//# sourceMappingURL=all.js.map
